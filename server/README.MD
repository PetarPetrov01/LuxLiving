# Property Service REST API Documentation
|Contents
| ---
| [Authentication](#authorized-request)
| - [Register](#register)
| - [Login](#login)
| - [Logout](#logout)
| [Properties CRUD opeartions](#property-service)
| - [Get all](#get-all-properties)


This document provides details about the REST API endpoints exposed by the Property Service. The service allows users to create their own profile,manage properties, place bids, and retrieve property information.

### Error Responses

If there is an error processing a request, the API will respond with an appropriate HTTP status code and a JSON object containing an error message.

Example error response:

```json
{
  "message": "Invalid request, missing required parameter."
}
```
## Authorized request 

To access some of the endpoints (e.g. creating and managing posts, placing a bid), authentication is required. Users need to include a valid JWT token in the authorization header of their HTTP requests.

```
Request Headers:
"Authorization": {accessToken}
```

All authentication-related endpoints are under the `/users` namespace.

### Register

To create a new user send a `POST` request to `/users/register` with email and password. Upon successfull request, the service creates a session and returns an authorized token (accessToken).

#### Example regsiter request
```
POST /users/register
Content-Type: application/json
```
Request body:
```js
{
  email: "example_email",
  password: "example_pass"
}
```
#### Example regsiter response
```js
{
    _id: {id generated by the service},
    email: "example_email",
    accessToken: {generatedAccessToken}
}
```
### Login
To log in as an already created user send `POST` request to `/users/login`. The service authenticates the user and returns an object with accessToken for subsequent requests.
#### Example login request
```
POST /users/login
Content-Type: application/json
```
Request body:
```js
{
  email: "example_email",
  password: "example_pass"
}
```
#### Example login response
The service responds with the object similar to what is found in the [registration](#example-request) process.

### Logout
To logout the current user, send an authorized `GET` request to `/users/logout`. The service blakclists the token and responds with 204 - No Content.

### Property service
The base url for accessing the properties is `/data/catalog`
### Get all Properties
To retrieve a list of all properties send `GET` request to `/data/catalog` with the following optional queries:

* search : Filters properties by name or location (case-insensitive).
* sort : Sorts the properties based on a specified property and order ("asc" for ascending and "desc" for ascending).
* limit : Limits the number of properties returned (default is all). 

#### Example properties request

To get all properties send a `GET` request to `/data/catalog`.
The server responds with an array of objects representing different real estate properties. Beside the regular properties (as in object keys), the objects include automatically generated properties, which are as follows:

##### Automatically generated properties:
    * _id - Unique ID in the form of string.
    * createdAt - Time stamp of the creation.
    * updatedAt - The time of the last update.

The whole object with all its properties looks like this:
```json
{
  "_id": "{generatedId}",
  "name": "Example house",
  "location": "Some town, Some country",
  "area": 200,
  "imageUrl": "{image URL}",
  "description": "Some property description",
  "price": 400900,
  "_ownerId": "{generatedIdOfOwner}",
  "createdAt": "{generatedDate}",
  "updatedAt":  "{generatedDate}",
  "currentBidder":"{generatedIdOfBidder}"
}
```

#### Search
Append `search={match}` to the query paramaters, where {match} is a string. The server filters the properties by name or location with the matching string (case insensitive). For example to get all properties which are located in USA send the following request:
```
GET /data/catalog?search=usa
```
#### Sorting
To sort the real estate properties by some of their properties append `sort={propertyToSort} {order}` as encoded URI string. Where order could be `asc` for ascending and `desc` for descending order. 
To get all properties, sorted by time of creation send the following request:
```
GET /data/catalog?sort=createdAt%20desc
```
#### Limit 
To get a particular count of properties, append `limit={count}` to the query parameters. The server provides the precise count of records in the database, only if there are that many records available. Note that if sort query is not passed, the default properties are sorted by time of creation and ascending order (Oldest first). The sort is always done before the limit, so the order of the query parameters does not matter.

#### Example including all queries
To retrieve the three most recently created properties which include "house" in their names, use the following request:

```
GET /data/catalog?search=house&sort=createdAt%20desc&limit=3
```
